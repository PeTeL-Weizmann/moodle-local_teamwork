function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("local_teamwork/init",["jquery","core/str","core/ajax","local_teamwork/popup","local_teamwork/render","local_teamwork/dragula","local_teamwork/skin","local_teamwork/loading","core/notification"],function(a,b,c,d,e,f,g,h,i){'use strict';var j=document.querySelector("body"),k=function(a,b,e,f){c.call([{methodname:"local_teamwork_set_teamwork_enable",args:{activityid:+b,moduletype:e},done:function done(a){f(a)},fail:function fail(){d.error()}}])},l=function(a,b,e,f){f.checked;c.call([{methodname:"local_teamwork_set_access_to_student",args:{activityid:+b,moduletype:e},done:function done(){},fail:function fail(){d.error()}}])},m=function(a,b,e,f,g){h.show();c.call([{methodname:"local_teamwork_add_new_card",args:{courseid:+a,activityid:+b,moduletype:e,selectgroupid:f},done:function done(a){h.remove();g(a)},fail:function fail(){h.remove();d.error()}}])},n=function(a,b,e,f,g){h.show();c.call([{methodname:"local_teamwork_delete_card",args:{teamid:a},done:function done(a){h.remove();g(a)},fail:function fail(){h.remove();d.error()}}])},o=function(){c.call([{methodname:"local_teamwork_show_random_popup",args:{},done:function done(a){var b=JSON.parse(a.result);d.textHead=b.header;d.text=b.content;d.show()},fail:function fail(){d.error()}}])},p=function(){var a=document.querySelector("#teamuserallowenddate"),b=Array.from(document.querySelectorAll(".teamuserenddate-inputs-wrapper input, .teamuserenddate-inputs-wrapper select"));a.addEventListener("change",function(a){if(a.target.checked){b.forEach(function(a){a.removeAttribute("disabled")});a.target.value="1"}else{b.forEach(function(a){a.setAttribute("disabled","disabled")});a.target.value="0"}})},q=function(a,b){c.call([{methodname:"local_teamwork_render_student_settings_popup",args:{activityid:a,moduletype:b},done:function done(a){var b=JSON.parse(a.result);d.textHead=b.header;d.text=b.content;d.show();setTimeout(p,1e3)},fail:function fail(){d.error()}}])},r=function(a,b,e){var f=document.querySelector(".teamwork-modal"),g=f.querySelector("#teamnumbers").value,i=f.querySelector("#teamusernumbers").value,j=f.querySelector("input[name=team-userend-date]").value,k=f.querySelector("select[name=team-userend-month]").value,l=f.querySelector("input[name=team-userend-year]").value,m=f.querySelector("input[name=team-userend-hour]").value,n=f.querySelector("input[name=team-userend-minute]").value,o=f.querySelector("input[name=teamuserallowenddate]").value;h.show();c.call([{methodname:"local_teamwork_student_settings_popup_data",args:{courseid:+a,activityid:+b,moduletype:e,teamnumbers:+g,teamusernumbers:+i,teamuserenddate:+j,teamuserendmonth:+k,teamuserendyear:+l,teamuserendhour:+m,teamuserendminute:+n,teamuserallowenddate:+o},done:function done(){h.remove()},fail:function fail(){d.error()}}])},s=function(a,b,e,f,g,i){while(!a.classList.contains("teamwork-modal")){a=a.parentNode}var j=a.querySelector("#student_number").value;h.show();c.call([{methodname:"local_teamwork_set_random_teams",args:{courseid:+b,activityid:+e,moduletype:f,selectgroupid:g,numberofstudent:+j},done:function done(a){h.remove();i(a)},fail:function fail(){h.remove();d.error()}}])},t=function(a){var b=a.dataset.team_id,e=a.value;c.call([{methodname:"local_teamwork_set_new_team_name",args:{cardid:+b,cardname:e},done:function done(){},fail:function fail(){d.error()}}])},u=function(a){var b=Array.from(document.querySelectorAll("#studentList div[data-student_id]")),c="visuallyhidden",d=a.value;if(!d){b.forEach(function(a){a.classList.remove(c)});return}b.forEach(function(a){if(0<=a.innerHTML.toLowerCase().search(d.toLowerCase())){a.classList.remove(c)}else{a.classList.add(c)}})},v=function(){var a=j.querySelector("input[data-handler = \"search_student\"]");a.addEventListener("input",function(){u(a)})},w=function(){var a=Array.from(document.querySelectorAll("#studentList div[data-student_id]")),b=j.querySelector("input[data-handler = \"search_student\"]");b.value="";a.forEach(function(a){a.classList.remove("visuallyhidden")})};return{init:function init(b,d,e,f){var g=this;c.call([{methodname:"local_teamwork_render_block_html_page",args:{courseid:+b,activityid:+d,moduletype:e,selectgroupid:f},done:function done(c){var h=a("body#page-mod-assign-view #intro");h.append(c.result);g.renderHtmlToPage(b,d,e,f)},fail:i.exception}])},renderHtmlToPage:function renderHtmlToPage(b,c,h,i){e.data={sesskey:M.cfg.sesskey,courseid:b,activityid:c,moduletype:h,selectgroupid:i};a("#open_local").on("click",function(){e.mainBlock(v)});document.addEventListener("click",function(f){var p=f.target;while(p!==j){if("teamwork_toggle"===p.dataset.handler){p.classList.toggle("active");a(".skin_shadow").toggleClass("skin_show");a(".skin_shadow").toggleClass("skin_hide");k(b,c,h);return}if(p.classList.contains("close_popup")||p.classList.contains("teamwork-modal_close")){if(p.classList.contains("stop-close")){return}d.remove();return}if(p.classList.contains("skin_close")||p.classList.contains("close_btn")){g.remove();return}if("access_to_student"===p.dataset.handler){if(p.classList.contains("active")){p.classList.remove("active");l(b,c,h,p)}else{p.classList.add("active");q(c,h);l(b,c,h,p)}}if("get_popup_data"===p.dataset.handler){f.preventDefault();r(b,c,h);d.remove();return}if("open_group_selection"===p.dataset.handler){a(p).next().slideToggle();return}if("select_groups"===p.dataset.handler){var t=function(){var b=document.querySelector("html[lang=\"en\"]")?"choose grous":"\u05D1\u05D7\u05E8 \u05E7\u05D1\u05D5\u05E6\u05D4";if(p.classList.contains("selected")){return{v:void 0}}p.classList.toggle("selected");a("div[data-handler=\"open_group_selection\"]").html(p.classList.contains("selected")?p.innerHTML:b);a(p).siblings().removeClass("selected");var c=[],d=Array.from(p.parentNode.children);d.forEach(function(a){if(a.classList.contains("selected")){c.push(a.dataset.value)}});a(p).parent().slideToggle();i=JSON.stringify(c);e.data.selectgroupid=JSON.stringify(c);e.studentList();e.teamsCard();return{v:void 0}}();if("object"===_typeof(t))return t.v}if("add_new_teamcard"===p.dataset.handler){m(b,c,h,i,function(){e.setDefaultData();e.studentList();e.teamsCard()});return}if("delete_teamcard"===p.dataset.handler){var u=p.dataset.remove_team_id;n(u,b,c,h,function(){e.setDefaultData();e.teamsCard();e.studentList()});return}if("random_popup"===p.dataset.handler){o();return}if("random"===p.dataset.handler){s(p,b,c,h,e.data.selectgroupid,function(){e.teamsCard();e.studentList();d.remove()});return}if("search_reset"===p.dataset.handler){w(p);return}p=p.parentNode}});f.startDrag();document.addEventListener("change",function(a){if("input_team_name"===a.target.dataset.handler){t(a.target)}});document.addEventListener("keydown",function(a){if(27===a.keyCode){g.remove();d.remove()}})}}});
//# sourceMappingURL=init.min.js.map
