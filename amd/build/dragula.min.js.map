{"version":3,"file":"dragula.min.js","sources":["../src/dragula.js"],"sourcesContent":["define([\r\n    'core/str',\r\n    'core/ajax',\r\n    'local_teamwork/render',\r\n    'local_teamwork/popup',\r\n    'local_teamwork/loading',\r\n    'local_teamwork/dragulasource',\r\n    'core/modal_factory',\r\n    'core/modal_events',\r\n    'core/notification',\r\n], function (Str, Ajax, render, popup, loadingIcon, dragula, ModalFactory, ModalEvents, Notification) {\r\n    'use strict';\r\n\r\n    const renderPageAfterDrag = (el, removeteam, callback) => {\r\n\r\n        const allTeamsBlocks = Array.from(document.querySelectorAll('div[data-team_id]'));\r\n        const allTeams = [];\r\n        const draguserid = el.dataset.student_id;\r\n\r\n        let teamid;\r\n        allTeamsBlocks.forEach((item) => {\r\n            let team = {};\r\n            team.teamid = item.dataset.team_id;\r\n            team.studentid = [];\r\n\r\n            let allStudents = Array.from(item.querySelectorAll('.teamwork_student'));\r\n            allStudents.forEach((student) => {\r\n                team.studentid.push(student.dataset.student_id);\r\n            });\r\n            allTeams.push(team);\r\n        });\r\n\r\n        loadingIcon.show();\r\n        Ajax.call([{\r\n            methodname: 'local_teamwork_drag_student_card',\r\n            args: {\r\n                courseid: Number(render.data.courseid),\r\n                activityid: Number(render.data.activityid),\r\n                moduletype: render.data.moduletype,\r\n                selectgroupid: render.data.selectgroupid,\r\n                newteamspost: JSON.stringify(allTeams),\r\n                draguserid: Number(draguserid),\r\n                removeteam: removeteam,\r\n            },\r\n            done: function (data) {\r\n                loadingIcon.remove();\r\n                callback(data);\r\n            },\r\n            fail: function () {\r\n                loadingIcon.remove();\r\n                popup.error();\r\n            }\r\n        }]);\r\n    };\r\n\r\n    const checkOverflowAndRender = (el, target, source) => {\r\n\r\n        let maxCount = source.dataset.max_count;\r\n\r\n        if (target.childElementCount === maxCount) {\r\n            target.classList.add('stop-drag');\r\n        }\r\n        if (source.childElementCount < maxCount) {\r\n            source.classList.remove('stop-drag');\r\n        }\r\n\r\n        // If drag to student list.\r\n        if($(target).hasClass('teamwork_students')){\r\n            let item = $(source).parent().find('.teamwork_team-inner');\r\n\r\n            // Delete user submission.\r\n            if ($(el).find('.delete_user_submit-btn').length) {\r\n                $(el).find('.delete_user_submit-btn')[0].click();\r\n            } else {\r\n                renderPageAfterDrag(el, false, function () {\r\n                    render.setDefaultData();\r\n                    render.studentList();\r\n                    render.teamsCard();\r\n                });\r\n            }\r\n\r\n            // Close popup \"remove teamcard\".\r\n            // if(item.find('.teamwork_student').length === 0){\r\n            //     Str.get_strings([\r\n            //         { key: 'titlepopupremoveteam', component: 'local_teamwork' },\r\n            //         { key: 'contentpopupremoveteam', component: 'local_teamwork' },\r\n            //         { key: 'buttonpopupremoveteam', component: 'local_teamwork' },\r\n            //     ]).done(function (strings) {\r\n            //\r\n            //         var modalPromise = ModalFactory.create({\r\n            //             type: ModalFactory.types.SAVE_CANCEL,\r\n            //             title: strings[0],\r\n            //             body: strings[1]\r\n            //         });\r\n            //\r\n            //         $.when(modalPromise).then(function (fmodal) {\r\n            //\r\n            //             fmodal.setSaveButtonText(strings[2]);\r\n            //\r\n            //             // Handle save event.\r\n            //             fmodal.getRoot().on(ModalEvents.save, function (e) {\r\n            //                 e.preventDefault();\r\n            //\r\n            //                 renderPageAfterDrag(el, true, function () {\r\n            //                     render.setDefaultData();\r\n            //                     render.studentList();\r\n            //                     render.teamsCard();\r\n            //                 });\r\n            //\r\n            //                 fmodal.destroy();\r\n            //             });\r\n            //\r\n            //             fmodal.getRoot().on(ModalEvents.hidden, function () {\r\n            //\r\n            //                 renderPageAfterDrag(el, false, function () {\r\n            //                     render.setDefaultData();\r\n            //                     render.studentList();\r\n            //                     render.teamsCard();\r\n            //                 });\r\n            //\r\n            //                 fmodal.destroy();\r\n            //             });\r\n            //\r\n            //             return fmodal;\r\n            //         }).done(function (modal) {\r\n            //             modal.show();\r\n            //         }).fail(Notification.exception);\r\n            //     })\r\n            // }else{\r\n            //     renderPageAfterDrag(el, false, function () {\r\n            //         render.setDefaultData();\r\n            //         render.studentList();\r\n            //         render.teamsCard();\r\n            //     });\r\n            // }\r\n        }else{\r\n            renderPageAfterDrag(el, false, function () {\r\n                render.setDefaultData();\r\n                render.studentList();\r\n                render.teamsCard();\r\n            });\r\n        }\r\n    };\r\n\r\n    const drag = {\r\n        startDrag: function () {\r\n            dragula({\r\n                isContainer: function (el) {\r\n                    return el.classList.contains('draggable');\r\n                },\r\n                accepts: function (el, target) {\r\n                    if (!target.classList.contains('stop-drag')) {\r\n                        return target;\r\n                    }\r\n\r\n                },\r\n                invalid: function (el, handle) {\r\n                    if (el.classList.contains('stop-drag-item')) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }).on('drop', checkOverflowAndRender)\r\n        }\r\n    };\r\n\r\n    return drag;\r\n});\r\n"],"names":["define","Str","Ajax","render","popup","loadingIcon","dragula","ModalFactory","ModalEvents","Notification","renderPageAfterDrag","el","removeteam","callback","allTeamsBlocks","Array","from","document","querySelectorAll","allTeams","draguserid","dataset","student_id","forEach","item","team","teamid","team_id","studentid","student","push","show","call","methodname","args","courseid","Number","data","activityid","moduletype","selectgroupid","newteamspost","JSON","stringify","done","remove","fail","error","checkOverflowAndRender","target","source","maxCount","max_count","childElementCount","classList","add","$","hasClass","parent","find","length","click","setDefaultData","studentList","teamsCard","startDrag","isContainer","contains","accepts","invalid","handle","on"],"mappings":"AAAAA,gCAAO,CACH,WACA,YACA,wBACA,uBACA,yBACA,+BACA,qBACA,oBACA,sBACD,SAAUC,IAAKC,KAAMC,OAAQC,MAAOC,YAAaC,QAASC,aAAcC,YAAaC,oBAG9EC,oBAAsB,CAACC,GAAIC,WAAYC,kBAEnCC,eAAiBC,MAAMC,KAAKC,SAASC,iBAAiB,sBACtDC,SAAW,GACXC,WAAaT,GAAGU,QAAQC,WAG9BR,eAAeS,SAASC,WAChBC,KAAO,GACXA,KAAKC,OAASF,KAAKH,QAAQM,QAC3BF,KAAKG,UAAY,GAECb,MAAMC,KAAKQ,KAAKN,iBAAiB,sBACvCK,SAASM,UACjBJ,KAAKG,UAAUE,KAAKD,QAAQR,QAAQC,eAExCH,SAASW,KAAKL,SAGlBpB,YAAY0B,OACZ7B,KAAK8B,KAAK,CAAC,CACPC,WAAY,mCACZC,KAAM,CACFC,SAAUC,OAAOjC,OAAOkC,KAAKF,UAC7BG,WAAYF,OAAOjC,OAAOkC,KAAKC,YAC/BC,WAAYpC,OAAOkC,KAAKE,WACxBC,cAAerC,OAAOkC,KAAKG,cAC3BC,aAAcC,KAAKC,UAAUxB,UAC7BC,WAAYgB,OAAOhB,YACnBR,WAAYA,YAEhBgC,KAAM,SAAUP,MACZhC,YAAYwC,SACZhC,SAASwB,OAEbS,KAAM,WACFzC,YAAYwC,SACZzC,MAAM2C,aAKZC,uBAAyB,CAACrC,GAAIsC,OAAQC,cAEpCC,SAAWD,OAAO7B,QAAQ+B,aAE1BH,OAAOI,oBAAsBF,UAC7BF,OAAOK,UAAUC,IAAI,aAErBL,OAAOG,kBAAoBF,UAC3BD,OAAOI,UAAUT,OAAO,aAIzBW,EAAEP,QAAQQ,SAAS,qBAAqB,CAC5BD,EAAEN,QAAQQ,SAASC,KAAK,wBAG/BH,EAAE7C,IAAIgD,KAAK,2BAA2BC,OACtCJ,EAAE7C,IAAIgD,KAAK,2BAA2B,GAAGE,QAEzCnD,oBAAoBC,IAAI,GAAO,WAC3BR,OAAO2D,iBACP3D,OAAO4D,cACP5D,OAAO6D,oBA2DftD,oBAAoBC,IAAI,GAAO,WAC3BR,OAAO2D,iBACP3D,OAAO4D,cACP5D,OAAO6D,sBAKN,CACTC,UAAW,WACP3D,QAAQ,CACJ4D,YAAa,SAAUvD,WACZA,GAAG2C,UAAUa,SAAS,cAEjCC,QAAS,SAAUzD,GAAIsC,YACdA,OAAOK,UAAUa,SAAS,oBACpBlB,QAIfoB,QAAS,SAAU1D,GAAI2D,WACf3D,GAAG2C,UAAUa,SAAS,yBACf,KAGhBI,GAAG,OAAQvB"}