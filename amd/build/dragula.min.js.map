{"version":3,"sources":["../src/dragula.js"],"names":["define","Ajax","render","popup","loadingIcon","dragula","renderPageAfterDrag","el","callback","allTeamsBlocks","Array","from","document","querySelectorAll","allTeams","draguserid","dataset","student_id","forEach","item","team","teamid","team_id","studentid","allStudents","student","push","show","call","methodname","args","courseid","data","activityid","moduletype","selectgroupid","newteamspost","JSON","stringify","done","remove","fail","error","checkOverflowAndRender","target","source","maxCount","max_count","childElementCount","classList","add","setDefaultData","studentList","teamsCard","startDrag","isContainer","contains","accepts","invalid","on"],"mappings":"AAAAA,OAAM,0BAAC,CACH,WADG,CAEH,uBAFG,CAGH,sBAHG,CAIH,wBAJG,CAKH,8BALG,CAAD,CAMH,SAAUC,CAAV,CAAgBC,CAAhB,CAAwBC,CAAxB,CAA+BC,CAA/B,CAA4CC,CAA5C,CAAqD,CACpD,aADoD,GAG9CC,CAAAA,CAAmB,CAAG,SAACC,CAAD,CAAKC,CAAL,CAAkB,IAEpCC,CAAAA,CAAc,CAAGC,KAAK,CAACC,IAAN,CAAWC,QAAQ,CAACC,gBAAT,CAA0B,mBAA1B,CAAX,CAFmB,CAGpCC,CAAQ,CAAG,EAHyB,CAIpCC,CAAU,CAAGR,CAAE,CAACS,OAAH,CAAWC,UAJY,CAO1CR,CAAc,CAACS,OAAf,CAAuB,SAACC,CAAD,CAAU,IACzBC,CAAAA,CAAI,CAAG,CACNC,MADM,CACGF,CAAI,CAACH,OAAL,CAAaM,OADhB,CAENC,SAFM,CAEM,EAFN,CADkB,CAKzBC,CAAW,CAAGd,KAAK,CAACC,IAAN,CAAWQ,CAAI,CAACN,gBAAL,CAAsB,mBAAtB,CAAX,CALW,CAM7BW,CAAW,CAACN,OAAZ,CAAoB,SAACO,CAAD,CAAa,CAC7BL,CAAI,CAACG,SAAL,CAAeG,IAAf,CAAoBD,CAAO,CAACT,OAAR,CAAgBC,UAApC,CACH,CAFD,EAGAH,CAAQ,CAACY,IAAT,CAAcN,CAAd,CACH,CAVD,EAYAhB,CAAW,CAACuB,IAAZ,GACA1B,CAAI,CAAC2B,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,kCADL,CAEPC,IAAI,CAAE,CACFC,QAAQ,EAAS7B,CAAM,CAAC8B,IAAP,CAAYD,QAD3B,CAEFE,UAAU,EAAS/B,CAAM,CAAC8B,IAAP,CAAYC,UAF7B,CAGFC,UAAU,CAAEhC,CAAM,CAAC8B,IAAP,CAAYE,UAHtB,CAIFC,aAAa,CAAEjC,CAAM,CAAC8B,IAAP,CAAYG,aAJzB,CAKFC,YAAY,CAAEC,IAAI,CAACC,SAAL,CAAexB,CAAf,CALZ,CAMFC,UAAU,EAASA,CANjB,CAFC,CAUPwB,IAAI,CAAE,cAAUP,CAAV,CAAgB,CAClB5B,CAAW,CAACoC,MAAZ,GACAhC,CAAQ,CAACwB,CAAD,CACX,CAbM,CAcPS,IAAI,CAAE,eAAY,CACdrC,CAAW,CAACoC,MAAZ,GACArC,CAAK,CAACuC,KAAN,EACH,CAjBM,CAAD,CAAV,CAmBH,CA1CmD,CA4C9CC,CAAsB,CAAG,SAACpC,CAAD,CAAKqC,CAAL,CAAaC,CAAb,CAAwB,CAEnD,GAAIC,CAAAA,CAAQ,CAAGD,CAAM,CAAC7B,OAAP,CAAe+B,SAA9B,CAEA,GAAIH,CAAM,CAACI,iBAAP,GAA6BF,CAAjC,CAA2C,CACvCF,CAAM,CAACK,SAAP,CAAiBC,GAAjB,CAAqB,WAArB,CACH,CACD,GAAIL,CAAM,CAACG,iBAAP,CAA2BF,CAA/B,CAAyC,CACrCD,CAAM,CAACI,SAAP,CAAiBT,MAAjB,CAAwB,WAAxB,CACH,CAEDlC,CAAmB,CAACC,CAAD,CAAK,UAAY,CAChCL,CAAM,CAACiD,cAAP,GACAjD,CAAM,CAACkD,WAAP,GACAlD,CAAM,CAACmD,SAAP,EACH,CAJkB,CAMtB,CA7DmD,CAoFpD,MArBa,CACTC,SAAS,CAAE,oBAAY,CACnBjD,CAAO,CAAC,CACJkD,WAAW,CAAE,qBAAUhD,CAAV,CAAc,CACvB,MAAOA,CAAAA,CAAE,CAAC0C,SAAH,CAAaO,QAAb,CAAsB,WAAtB,CACV,CAHG,CAIJC,OAAO,CAAE,iBAAUlD,CAAV,CAAcqC,CAAd,CAAsB,CAC3B,GAAI,CAACA,CAAM,CAACK,SAAP,CAAiBO,QAAjB,CAA0B,WAA1B,CAAL,CAA6C,CACzC,MAAOZ,CAAAA,CACV,CAEJ,CATG,CAUJc,OAAO,CAAE,iBAAUnD,CAAV,CAAsB,CAC3B,GAAIA,CAAE,CAAC0C,SAAH,CAAaO,QAAb,CAAsB,gBAAtB,CAAJ,CAA6C,CACzC,QACH,CACJ,CAdG,CAAD,CAAP,CAeGG,EAfH,CAeM,MAfN,CAechB,CAfd,CAgBH,CAlBQ,CAsBhB,CA3FK,CAAN","sourcesContent":["define([\n    'core/ajax',\n    'local_teamwork/render',\n    'local_teamwork/popup',\n    'local_teamwork/loading',\n    'local_teamwork/dragulasource',\n], function (Ajax, render, popup, loadingIcon, dragula) {\n    'use strict';\n\n    const renderPageAfterDrag = (el, callback) => {\n\n        const allTeamsBlocks = Array.from(document.querySelectorAll('div[data-team_id]'));\n        const allTeams = [];\n        const draguserid = el.dataset.student_id;\n\n        let teamid;\n        allTeamsBlocks.forEach((item) => {\n            let team = {};\n            team.teamid = item.dataset.team_id;\n            team.studentid = [];\n\n            let allStudents = Array.from(item.querySelectorAll('.teamwork_student'));\n            allStudents.forEach((student) => {\n                team.studentid.push(student.dataset.student_id);\n            });\n            allTeams.push(team);\n        });\n\n        loadingIcon.show();\n        Ajax.call([{\n            methodname: 'local_teamwork_drag_student_card',\n            args: {\n                courseid: Number(render.data.courseid),\n                activityid: Number(render.data.activityid),\n                moduletype: render.data.moduletype,\n                selectgroupid: render.data.selectgroupid,\n                newteamspost: JSON.stringify(allTeams),\n                draguserid: Number(draguserid),\n            },\n            done: function (data) {\n                loadingIcon.remove();\n                callback(data);\n            },\n            fail: function () {\n                loadingIcon.remove();\n                popup.error();\n            }\n        }]);\n    };\n\n    const checkOverflowAndRender = (el, target, source) => {\n\n        let maxCount = source.dataset.max_count;\n\n        if (target.childElementCount === maxCount) {\n            target.classList.add('stop-drag');\n        }\n        if (source.childElementCount < maxCount) {\n            source.classList.remove('stop-drag');\n        }\n\n        renderPageAfterDrag(el, function () {\n            render.setDefaultData();\n            render.studentList();\n            render.teamsCard();\n        });\n\n    };\n\n    const drag = {\n        startDrag: function () {\n            dragula({\n                isContainer: function (el) {\n                    return el.classList.contains('draggable');\n                },\n                accepts: function (el, target) {\n                    if (!target.classList.contains('stop-drag')) {\n                        return target;\n                    }\n\n                },\n                invalid: function (el, handle) {\n                    if (el.classList.contains('stop-drag-item')) {\n                        return true;\n                    }\n                }\n            }).on('drop', checkOverflowAndRender)\n        }\n    };\n\n    return drag;\n});\n"],"file":"dragula.min.js"}