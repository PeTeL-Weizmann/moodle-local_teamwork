{"version":3,"file":"rubric_export.min.js","sources":["../src/rubric_export.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the myoverview block.\n *\n * @package    local_teamwork\n * @copyright  2018 Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n        'jquery',\n        'core/str',\n        'core/ajax',\n        'core/notification',\n    ],\n    function ($, Str, Ajax, Notification) {\n\n        return {\n            selector: {\n                wrapper: '#rubric-advancedgrading',\n                wrapper_error: '#id_error_advancedgrading',\n                button: '#save-rubrics',\n            },\n\n            /**\n             * Initialise all of the modules for the overview block.\n             *\n             * @param {object} courseids The root element for the overview block.\n             */\n            init: function (userid, callback) {\n\n                // Get url param.\n                var queryDict = {}\n                location.search.substr(1).split(\"&\").forEach(function(item) {\n                    queryDict[item.split(\"=\")[0]] = item.split(\"=\")[1];\n                });\n\n                if (queryDict.id.length === 0 || queryDict.action.length === 0 || queryDict.action !== 'grader') return;\n\n                var assignid = queryDict.id;\n\n                var rubricsave_notice = '';\n                Str.get_string('rubricsave_notice', 'local_teamwork').done(function(translation) {\n                    rubricsave_notice = translation;\n                });\n                var button_name = '';\n                Str.get_string('rubricsave', 'local_teamwork').done(function(translation) {\n                    button_name = translation;\n                });\n\n                var self = this;\n                this.waitForElement(this.selector.wrapper, function () {\n                    $('<span></span><a id=\"save-rubrics\" class=\"btn btn-primary mt-10\" style=\"color:white;font-weight: bold;\">' +\n                        button_name + '</a>' + rubricsave_notice + '</span>').insertAfter(self.selector.wrapper);\n\n                    var root = $(self.selector.button);\n                    root.on('click', function (e) {\n                        var target = $(e.target);\n\n                        // Get the element.\n                        var element = window.document.getElementsByClassName(\"gradingform_rubric\")[0];\n\n                        var width = element.offsetWidth;\n                        width = width*(135/72);\n\n                        // var height = element.offsetHeight;\n                        var height = 841.89; // A4\n\n                        // Generate the PDF.\n                        self.loadingPage();\n                        require(['local_teamwork/html2pdf_bundle'], function(html2pdf) {\n\n                            // html2pdf().from(element).set({\n                            //     margin: 1,\n                            //     filename: 'test.pdf',\n                            //     html2canvas: { scale: 2 },\n                            //     jsPDF: {orientation: 'portrait', unit: 'in', format: 'letter', compressPDF: true}\n                            // }).save();\n\n                            html2pdf().from(element).set({\n                                margin: 1,\n                                filename: 'test.pdf',\n                                html2canvas: {scale: 2},\n                                jsPDF: {orientation: 'portrait', unit: 'pt', format: [width, height], compressPDF: true}\n                            }).outputPdf().then(function (pdf) {\n\n                                Ajax.call([{\n                                    methodname: 'local_teamwork_save_rubrics_pdf',\n                                    args: {\n                                        assignid: Number(assignid),\n                                        userid: Number(userid),\n                                        content: btoa(pdf)\n                                    },\n                                    done: function () {\n                                        callback();\n                                    },\n                                    fail: Notification.exception\n                                }]);\n                            });\n                        });\n\n                    });\n                });\n            },\n\n            waitForElement: function (elementPath, callBack) {\n                var self = this;\n                window.setTimeout(function () {\n                    if ($(elementPath).length) {\n                        callBack(elementPath, $(elementPath));\n                    } else {\n                        self.waitForElement(elementPath, callBack);\n                    }\n                }, 500);\n            },\n\n            loadingPage: function () {\n                var shadowStyle=\"display: flex; position: fixed; z-index: 99999; top: 0; bottom: 0; right: 0; left: 0; background: #0000006b;\"\n                var spinnerStyle = \"margin: auto;\" +\n                    \"width: 6rem;\" +\n                    \"height: 6rem;\" +\n                    \"border: .6em solid #fff;\" +\n                    \"border-right-color: transparent;\" +\n                    \"border-radius: 50%;\" +\n                    \"animation: spinner-border .75s linear infinite;\";\n                var spinner = '<div class = \"spinner\" style = \"'+ spinnerStyle +'\"></div>';\n                var shadow = $('<div class = \"loading\" style=\"'+ shadowStyle +'\">'+ spinner +'</div>');\n                $('body').append(shadow);\n            }\n        };\n    });\n"],"names":["define","$","Str","Ajax","Notification","selector","wrapper","wrapper_error","button","init","userid","callback","queryDict","location","search","substr","split","forEach","item","id","length","action","assignid","rubricsave_notice","get_string","done","translation","button_name","self","this","waitForElement","insertAfter","on","e","target","element","window","document","getElementsByClassName","width","offsetWidth","loadingPage","require","html2pdf","from","set","margin","filename","html2canvas","scale","jsPDF","orientation","unit","format","compressPDF","outputPdf","then","pdf","call","methodname","args","Number","content","btoa","fail","exception","elementPath","callBack","setTimeout","shadow","append"],"mappings":";;;;;;;AAuBAA,sCAAO,CACC,SACA,WACA,YACA,sBAEJ,SAAUC,EAAGC,IAAKC,KAAMC,oBAEb,CACHC,SAAU,CACNC,QAAS,0BACTC,cAAe,4BACfC,OAAQ,iBAQZC,KAAM,SAAUC,OAAQC,cAGhBC,UAAY,MAChBC,SAASC,OAAOC,OAAO,GAAGC,MAAM,KAAKC,SAAQ,SAASC,MAClDN,UAAUM,KAAKF,MAAM,KAAK,IAAME,KAAKF,MAAM,KAAK,MAGxB,IAAxBJ,UAAUO,GAAGC,QAA4C,IAA5BR,UAAUS,OAAOD,QAAqC,WAArBR,UAAUS,YAExEC,SAAWV,UAAUO,GAErBI,kBAAoB,GACxBrB,IAAIsB,WAAW,oBAAqB,kBAAkBC,MAAK,SAASC,aAChEH,kBAAoBG,mBAEpBC,YAAc,GAClBzB,IAAIsB,WAAW,aAAc,kBAAkBC,MAAK,SAASC,aACzDC,YAAcD,mBAGdE,KAAOC,UACNC,eAAeD,KAAKxB,SAASC,SAAS,WACvCL,EAAE,0GACE0B,YAAc,OAASJ,kBAAoB,WAAWQ,YAAYH,KAAKvB,SAASC,SAEzEL,EAAE2B,KAAKvB,SAASG,QACtBwB,GAAG,SAAS,SAAUC,GACVhC,EAAEgC,EAAEC,YAGbC,QAAUC,OAAOC,SAASC,uBAAuB,sBAAsB,GAEvEC,MAAQJ,QAAQK,YACpBD,aAMAX,KAAKa,cACLC,QAAQ,CAAC,mCAAmC,SAASC,UASjDA,WAAWC,KAAKT,SAASU,IAAI,CACzBC,OAAQ,EACRC,SAAU,WACVC,YAAa,CAACC,MAAO,GACrBC,MAAO,CAACC,YAAa,WAAYC,KAAM,KAAMC,OAAQ,CAACd,MAjBjD,QAiBiEe,aAAa,KACpFC,YAAYC,MAAK,SAAUC,KAE1BtD,KAAKuD,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAM,CACFtC,SAAUuC,OAAOvC,UACjBZ,OAAQmD,OAAOnD,QACfoD,QAASC,KAAKN,MAElBhC,KAAM,WACFd,YAEJqD,KAAM5D,aAAa6D,2BAS3CnC,eAAgB,SAAUoC,YAAaC,cAC/BvC,KAAOC,KACXO,OAAOgC,YAAW,WACVnE,EAAEiE,aAAa9C,OACf+C,SAASD,YAAajE,EAAEiE,cAExBtC,KAAKE,eAAeoC,YAAaC,YAEtC,MAGP1B,YAAa,eAUL4B,OAASpE,EAAE,8VACfA,EAAE,QAAQqE,OAAOD,SAG5B"}