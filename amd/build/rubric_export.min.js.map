{"version":3,"sources":["../src/rubric_export.js"],"names":["define","$","Str","Ajax","Notification","selector","wrapper","wrapper_error","button","init","userid","callback","queryDict","location","search","substr","split","forEach","item","id","length","action","assignid","rubricsave_notice","get_string","done","translation","button_name","self","waitForElement","insertAfter","root","on","e","target","element","window","document","getElementsByClassName","loadingPage","require","html2pdf","from","set","margin","filename","html2canvas","scale","jsPDF","orientation","unit","format","compressPDF","outputPdf","then","pdf","call","methodname","args","content","btoa","fail","exception","elementPath","callBack","setTimeout","shadow","append"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the myoverview block.\n *\n * @package    local_teamwork\n * @copyright  2018 Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n        'jquery',\n        'core/str',\n        'core/ajax',\n        'core/notification',\n    ],\n    function ($, Str, Ajax, Notification) {\n\n        return {\n            selector: {\n                wrapper: '#rubric-advancedgrading',\n                wrapper_error: '#id_error_advancedgrading',\n                button: '#save-rubrics',\n            },\n\n            /**\n             * Initialise all of the modules for the overview block.\n             *\n             * @param {object} courseids The root element for the overview block.\n             */\n            init: function (userid, callback) {\n\n                // Get url param.\n                var queryDict = {}\n                location.search.substr(1).split(\"&\").forEach(function(item) {\n                    queryDict[item.split(\"=\")[0]] = item.split(\"=\")[1];\n                });\n\n                if (queryDict.id.length === 0 || queryDict.action.length === 0 || queryDict.action !== 'grader') return;\n\n                var assignid = queryDict.id;\n\n                var rubricsave_notice = '';\n                Str.get_string('rubricsave_notice', 'local_teamwork').done(function(translation) {\n                    rubricsave_notice = translation;\n                });\n                var button_name = '';\n                Str.get_string('rubricsave', 'local_teamwork').done(function(translation) {\n                    button_name = translation;\n                });\n\n                var self = this;\n                this.waitForElement(this.selector.wrapper, function () {\n                    $('<span></span><a id=\"save-rubrics\" class=\"btn btn-primary mt-10\" style=\"color:white;font-weight: bold;\">' +\n                        button_name + '</a>' + rubricsave_notice + '</span>').insertAfter(self.selector.wrapper);\n\n                    var root = $(self.selector.button);\n                    root.on('click', function (e) {\n                        var target = $(e.target);\n\n                        // Get the element.\n                        var element = window.document.getElementsByClassName(\"gradingform_rubric\")[0];\n\n                        // Generate the PDF.\n                        self.loadingPage();\n                        require(['local_teamwork/html2pdf_bundle'], function(html2pdf) {\n\n                            // html2pdf().from(element).set({\n                            //     margin: 1,\n                            //     filename: 'test.pdf',\n                            //     html2canvas: { scale: 2 },\n                            //     jsPDF: {orientation: 'portrait', unit: 'in', format: 'letter', compressPDF: true}\n                            // }).save();\n\n                            html2pdf().from(element).set({\n                                margin: 1,\n                                filename: 'test.pdf',\n                                html2canvas: {scale: 2},\n                                jsPDF: {orientation: 'portrait', unit: 'in', format: 'letter', compressPDF: true}\n                            }).outputPdf().then(function (pdf) {\n\n                                Ajax.call([{\n                                    methodname: 'local_teamwork_save_rubrics_pdf',\n                                    args: {\n                                        assignid: Number(assignid),\n                                        userid: Number(userid),\n                                        content: btoa(pdf)\n                                    },\n                                    done: function () {\n                                        callback();\n                                    },\n                                    fail: Notification.exception\n                                }]);\n                            });\n                        });\n\n                    });\n                });\n            },\n\n            waitForElement: function (elementPath, callBack) {\n                var self = this;\n                window.setTimeout(function () {\n                    if ($(elementPath).length) {\n                        callBack(elementPath, $(elementPath));\n                    } else {\n                        self.waitForElement(elementPath, callBack);\n                    }\n                }, 500);\n            },\n\n            loadingPage: function () {\n                var shadowStyle=\"display: flex; position: fixed; z-index: 99999; top: 0; bottom: 0; right: 0; left: 0; background: #0000006b;\"\n                var spinnerStyle = \"margin: auto;\" +\n                    \"width: 6rem;\" +\n                    \"height: 6rem;\" +\n                    \"border: .6em solid #fff;\" +\n                    \"border-right-color: transparent;\" +\n                    \"border-radius: 50%;\" +\n                    \"animation: spinner-border .75s linear infinite;\";\n                var spinner = '<div class = \"spinner\" style = \"'+ spinnerStyle +'\"></div>';\n                var shadow = $('<div class = \"loading\" style=\"'+ shadowStyle +'\">'+ spinner +'</div>');\n                $('body').append(shadow);\n            }\n        };\n    });\n"],"file":"rubric_export.min.js"}