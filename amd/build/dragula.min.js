define("local_teamwork/dragula",["core/str","core/ajax","local_teamwork/render","local_teamwork/popup","local_teamwork/loading","local_teamwork/dragulasource","core/modal_factory","core/modal_events","core/notification"],(function(Str,Ajax,render,popup,loadingIcon,dragula,ModalFactory,ModalEvents,Notification){const renderPageAfterDrag=(el,removeteam,callback)=>{const allTeamsBlocks=Array.from(document.querySelectorAll("div[data-team_id]")),allTeams=[],draguserid=el.dataset.student_id;allTeamsBlocks.forEach((item=>{let team={};team.teamid=item.dataset.team_id,team.studentid=[],Array.from(item.querySelectorAll(".teamwork_student")).forEach((student=>{team.studentid.push(student.dataset.student_id)})),allTeams.push(team)})),loadingIcon.show(),Ajax.call([{methodname:"local_teamwork_drag_student_card",args:{courseid:Number(render.data.courseid),activityid:Number(render.data.activityid),moduletype:render.data.moduletype,selectgroupid:render.data.selectgroupid,newteamspost:JSON.stringify(allTeams),draguserid:Number(draguserid),removeteam:removeteam},done:function(data){loadingIcon.remove(),callback(data)},fail:function(){loadingIcon.remove(),popup.error()}}])},checkOverflowAndRender=(el,target,source)=>{let maxCount=source.dataset.max_count;if(target.childElementCount===maxCount&&target.classList.add("stop-drag"),source.childElementCount<maxCount&&source.classList.remove("stop-drag"),$(target).hasClass("teamwork_students")){$(source).parent().find(".teamwork_team-inner");$(el).find(".delete_user_submit-btn").length?$(el).find(".delete_user_submit-btn")[0].click():renderPageAfterDrag(el,!1,(function(){render.setDefaultData(),render.studentList(),render.teamsCard()}))}else renderPageAfterDrag(el,!1,(function(){render.setDefaultData(),render.studentList(),render.teamsCard()}))};return{startDrag:function(){dragula({isContainer:function(el){return el.classList.contains("draggable")},accepts:function(el,target){if(!target.classList.contains("stop-drag"))return target},invalid:function(el,handle){if(el.classList.contains("stop-drag-item"))return!0}}).on("drop",checkOverflowAndRender)}}}));

//# sourceMappingURL=dragula.min.js.map