define(["core/ajax","local_teamwork/render","local_teamwork/popup","local_teamwork/loading","local_teamwork/dragulasource"],function(t,a,e,r,o){"use strict";const s=(o,s,d)=>{let n=d.dataset.max_count;s.childElementCount===n&&s.classList.add("stop-drag"),d.childElementCount<n&&d.classList.remove("stop-drag"),((o,s)=>{const d=Array.from(document.querySelectorAll("div[data-team_id]")),n=[],i=o.dataset.student_id;d.forEach(t=>{let a={};a.teamid=t.dataset.team_id,a.studentid=[],Array.from(t.querySelectorAll(".teamwork_student")).forEach(t=>{a.studentid.push(t.dataset.student_id)}),n.push(a)}),r.show(),t.call([{methodname:"local_teamwork_drag_student_card",args:{courseid:Number(a.data.courseid),activityid:Number(a.data.activityid),moduletype:a.data.moduletype,selectgroupid:a.data.selectgroupid,newteamspost:JSON.stringify(n),draguserid:Number(i)},done:function(t){r.remove(),s(t)},fail:function(){r.remove(),e.error()}}])})(o,function(){a.setDefaultData(),a.studentList(),a.teamsCard()})};return{startDrag:function(){o({isContainer:function(t){return t.classList.contains("draggable")},accepts:function(t,a){if(!a.classList.contains("stop-drag"))return a},invalid:function(t,a){if(t.classList.contains("stop-drag-item"))return!0}}).on("drop",s)}}});